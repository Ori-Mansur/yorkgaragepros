
<script>
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
        initCharts();
        initTabs();
        calculateEstimate();
        
        // Listeners for ProjectEstimator
        ['garageSize', 'checkDoor', 'checkFloor', 'checkStorage'].forEach(id => {
            document.getElementById(id).addEventListener('change', calculateEstimate);
        });
    });

    // ROIAnalysis Component Logic
    function initCharts() {
        const ctx = document.getElementById('roiChart').getContext('2d');
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Garage Door Replacement', 'Manufactured Stone Veneer', 'Wood Deck Addition', 'Minor Kitchen Remodel', 'Bath Remodel'],
                datasets: [{
                    label: 'Cost Recouped at Resale (%)',
                    data: [93.8, 91.4, 65.8, 72.2, 60.1],
                    backgroundColor: [
                        '#B8860B', // Accent color for Garage Doors
                        '#E5E7EB',
                        '#E5E7EB',
                        '#E5E7EB',
                        '#E5E7EB'
                    ],
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.raw + '% ROI';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: { color: '#f3f4f6' },
                        title: { display: true, text: 'Return on Investment (%)' }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });
    }

    // ServiceExplorer Component Logic
    const serviceData = {
        doors: {
            title: "Premium Garage Doors",
            desc: "Your garage door can account for up to 40% of your home's facade. We install premium steel, wood-composite, and carriage house doors that boost efficiency.",
            points: ["R-18 Insulation Options", "Custom Hardware Packages", "Smart-Home Enabled"],
            icon: "shield"
        },
        floors: {
            title: "Epoxy Floor Coatings",
            desc: "Say goodbye to dusty, cracked concrete. Our industrial-grade epoxy system creates a seamless, non-slip surface that resists oil, salt, and tire marks.",
            points: ["1-Day Installation Available", "UV Stable (No Yellowing)", "Custom Flake Colors"],
            icon: "layers"
        },
        storage: {
            title: "Organization Systems",
            desc: "Reclaim your floor space. Our heavy-duty cabinets and slatwall systems are custom-designed to fit your tools, bikes, and bins perfectly.",
            points: ["75lb+ Weight Capacity per hook", "Steel-Backed Cabinets", "Modular & Adjustable"],
            icon: "box"
        }
    };

    function initTabs() {
        const tabs = document.querySelectorAll('.service-tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                // Reset all tabs
                tabs.forEach(t => t.classList.remove('active', 'bg-primary', 'text-white', 'border-primary'));
                tabs.forEach(t => t.classList.add('text-gray-600', 'border-gray-200'));
                
                // Activate clicked tab
                e.target.classList.add('active', 'bg-primary', 'text-white', 'border-primary');
                e.target.classList.remove('text-gray-600', 'border-gray-200');

                const key = e.target.dataset.target;
                const data = serviceData[key];
                
                // Update content
                document.getElementById('serviceTitle').innerText = data.title;
                document.getElementById('serviceDesc').innerText = data.desc;
                
                const listContainer = document.getElementById('serviceList');
                listContainer.innerHTML = '';
                data.points.forEach(point => {
                    listContainer.innerHTML += `
                        <li class="flex items-center text-sm">
                            <i data-lucide="check-circle" class="text-accent w-4 h-4 mr-2"></i> ${point}
                        </li>
                    `;
                });
                lucide.createIcons();

                // Update visual overlay
                const overlay = document.getElementById('visualOverlay');
                overlay.innerHTML = `
                    <div>
                        <i data-lucide="${data.icon}" class="w-16 h-16 text-accent mx-auto mb-4"></i>
                        <h4 class="text-2xl font-bold">${data.title}</h4>
                    </div>
                `;
                lucide.createIcons();
            });
        });
        
        // Initialize with the first tab clicked
        document.querySelector('.service-tab').click();
    }

    // ProjectEstimator Component Logic
    function calculateEstimate() {
        const size = parseInt(document.getElementById('garageSize').value);
        const hasDoor = document.getElementById('checkDoor').checked;
        const hasFloor = document.getElementById('checkFloor').checked;
        const hasStorage = document.getElementById('checkStorage').checked;

        let minPrice = 0;
        let maxPrice = 0;
        let days = 0;

        // Base price estimates per service for a 1-car garage (size factor is applied below)
        const doorBase = 1200; 
        const floorBase = 1800; 
        const storageBase = 800;

        if (hasDoor) {
            minPrice += doorBase * size;
            maxPrice += (doorBase * 1.5) * size; // Account for premium options
            days += 1;
        }

        if (hasFloor) {
            minPrice += floorBase * size;
            maxPrice += (floorBase * 1.3) * size;
            days += 2;
        }

        if (hasStorage) {
            minPrice += storageBase * size;
            maxPrice += (storageBase * 2.0) * size; // Storage systems have wider price variance
            days += 1;
        }

        const format = (num) => "$" + num.toLocaleString();
        
        const display = document.getElementById('priceDisplay');
        const timeDisplay = document.getElementById('timeDisplay');

        if (minPrice === 0) {
            display.innerText = "$0";
            timeDisplay.innerHTML = `<i data-lucide="clock" class="inline w-3 h-3 mr-1"></i> Select services`;
        } else {
            display.innerText = `${format(minPrice)} - ${format(maxPrice)}`;
            timeDisplay.innerHTML = `<i data-lucide="clock" class="inline w-3 h-3 mr-1"></i> Est. Timeline: ${days}-${days+1} Days`;
        }
        lucide.createIcons();
    }
</script>
